<!-- Include Socket.IO JavaScript -->
<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
<script type="text/javascript">
    var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);

    function appendMessage(message, sender) {
        var messagesDiv = document.getElementById('messages');
        var messageDiv = document.createElement('div');
        messageDiv.className = sender === 'user' ? 'user-message' : (sender === 'gemini' ? 'gemini-message' : 'gpt3_5-message');

        var prefix;
        if (sender === 'user') {
            prefix = 'You: ';
        } else if (sender === 'gemini') {
            prefix = 'Gemini: ';
        } else if (sender === 'gpt3_5') {
            prefix = 'GPT-3.5: ';
        }

        messageDiv.textContent = prefix + message;
        messagesDiv.appendChild(messageDiv);
    }

    socket.on('connect', function() {
        document.getElementById('sendButton').onclick = function() {
            var messageInput = document.getElementById('messageInput');
            var userMessage = messageInput.value.trim();

            if (userMessage) {
                // Append the user's message immediately to the chat
                appendMessage(userMessage, 'user');

                // Emit the message to the server
                socket.emit('send_message', {
                    chat_id: "{{ chat.id }}",
                    message: userMessage
                });

                // Clear the input after sending
                messageInput.value = '';  
            }
        };

        // Handle receiving messages from the server
        socket.on('gemini_message', function(data) {
            appendMessage(data.message, 'gemini');
        });

        socket.on('gpt3_5_message', function(data) {
            appendMessage(data.message, 'gpt3_5');
        });
    });
</script>



<h1>{{ chat.name }}</h1>
<div id="messages">
    <!-- Initial messages are loaded here by the server-side template -->
    {% for message in messages %}
    <div>
        {% if message.sender == 'user' %}
            User: {{ message.content }}
        {% elif message.sender == 'gemini' %}
            Gemini: {{ message.content }}
        {% elif message.sender == 'gpt3_5' %}
            Gpt-3.5: {{ message.content }}
        {% else %}
            {{ message.content }}
        {% endif %}
    </div>
    {% endfor %}
</div>
<input type="text" id="messageInput">
<button id="sendButton">Send</button>
